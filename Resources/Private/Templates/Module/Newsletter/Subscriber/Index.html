{namespace ps=Psmb\Newsletter\ViewHelpers}
{namespace neos=TYPO3\Neos\ViewHelpers}
<f:layout name="Default" />

<f:section name="headScripts">
</f:section>

<f:section name="Title">
</f:section>
<f:section name="Content">
	<fieldset>
		<div class="psmb-newsletter neos-main">
			<aside class="neos-aside">
				<form action="{f:uri.action(action: 'index')}" method="get" class="neos-search">
					<button type="submit" title="" data-neos-toggle="tooltip" data-original-title="Search in assets"><i class="icon-search"></i></button>
					<div>
						<input type="search" name="{f:if(condition: argumentNamespace, then: '{argumentNamespace}[searchTerm]', else: 'searchTerm')}" placeholder="Search" value="{searchTerm}" autofocus="autofocus" />
					</div>
				</form>
				<h2>
					{neos:backend.translate(id: 'newsletter.subscriptions.label', source: 'Modules', package: 'Psmb.Newsletter')}
					<f:link.action action="new" controller="Module\Newsletter\Subscription" class="neos-edit-toggle neos-button"><i class="icon-pencil"></i></f:link.action>
				</h2>
				<ul>
					<li>
						<f:link.action action="index" class="{f:if(condition: subscription, then: '', else: 'neos-active')}"><f:translate id="modules.actions.all">Show All</f:translate></f:link.action>
					</li>
					<f:for each="{subscriptions}" as="subscriptionItem">
						<li>
							<f:if condition="{subscription} == {subscriptionItem}">
								<f:then>
									<f:link.action action="index" class="neos-active" arguments="{subscription: subscriptionItem}">{subscriptionItem.name} <span class="neos-label">{subscriptionItem.fusionIdentifier}</span></f:link.action>
								</f:then>
								<f:else>
									<f:link.action action="index" arguments="{subscription: subscriptionItem}">{subscriptionItem.name} <span class="neos-label">{subscriptionItem.fusionIdentifier}</span></f:link.action>
								</f:else>
							</f:if>
						</li>
					</f:for>
				</ul>
			</aside>
			<div class="neos-content">
				<f:widget.paginate objects="{subscribers}" as="paginatedSubscribers" configuration="{itemsPerPage: settings.module.itemsPerPage, insertAbove: FALSE, insertBelow: true, maximumNumberOfLinks: 8}">
					<div class="neos-options">
						<div class="neos-show-options">
							<span class="count">
								<f:count>{paginatedSubscribers}</f:count> of <strong><f:count>{subscribers}</f:count>
							</span>
						</div>
						<div class="neos-view-options">
							<f:link.action action="new" title="New subscriber">
								<i class="icon-plus icon-white"></i>
							</f:link.action>
							<f:link.action action="import" addQueryString="TRUE" title="Import subscribers">
								<i class="icon-upload icon-white"></i>
							</f:link.action>
							<f:link.action action="export" useParentRequest="true" controller="Module\Newsletter\Subscriber" package="Psmb.Newsletter" arguments="{subscription: subscription}" addQueryString="TRUE" title="Export subscribers">
								<i class="icon-download icon-white"></i>
							</f:link.action>

							<div class="neos-dropdown" id="neos-sort-menu">
								<span title="" data-neos-toggle="tooltip" data-original-title="Sort options">
									<a class="dropdown-toggle" href="#" data-neos-toggle="dropdown" data-target="#neos-sort-menu">
										<i class="icon-sort-by-order"></i>
									</a>
								</span>
								<div class="neos-dropdown-menu-list neos-pull-right" role="menu">
									<span class="neos-dropdown-menu-list-title" title="">Sort by</span>
									<ul>
										<li>
											<f:link.action action="index" title="Sort by name" arguments="{sortBy: 'Name'}" addQueryString="TRUE" class="{f:if(condition: '{sortBy} == \'Name\'', then: 'neos-active')}"><i class="icon-sort-by-alphabet"></i> Name</f:link.action>
										</li>
										<li>
											<f:link.action action="index" title="Sort by email" arguments="{sortBy: 'Email'}" addQueryString="TRUE" class="{f:if(condition: '{sortBy} == \'Email\'', then: 'neos-active')}"><i class="icon-sort-by-order"></i> Email</f:link.action>
										</li>
									</ul>
									<span class="neos-dropdown-menu-list-title">Sort direction</span>
									<ul>
										<li>
											<f:link.action action="index" title="Sort direction Ascending" arguments="{sortDirection: 'ASC'}" addQueryString="TRUE" class="{f:if(condition: '{sortDirection} == \'ASC\'', then: 'neos-active')}"><i class="icon-sort-by-order"></i> Ascending</f:link.action>
										</li>
										<li>
											<f:link.action action="index" title="Sort direction Descending" arguments="{sortDirection: 'DESC'}" addQueryString="TRUE" class="{f:if(condition: '{sortDirection} == \'DESC\'', then: 'neos-active')}"><i class="icon-sort-by-order-alt"></i> Descending</f:link.action>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>

					<table class="neos-table">
						<thead>
						<tr>
							<th width="250">
								<f:if condition="{sortBy} == 'Name'">
									<f:then><f:translate id="module.subscriberName"/> <i class="icon-caret-down"></i></f:then>
									<f:else>
										<f:link.action action="index" title="Sort by name" data="{neos-toggle: 'tooltip'}" arguments="{sortBy: 'Name'}" addQueryString="TRUE"><f:translate id="module.subscriberName"/></f:link.action>
									</f:else>
								</f:if>
							</th>
							<th width="200">
								<f:if condition="{sortBy} == 'Email'">
									<f:then><f:translate id="module.subscriberEmail"/> <i class="icon-caret-down"></i></f:then>
									<f:else>
										<f:link.action action="index" title="Sort by email" data="{neos-toggle: 'tooltip'}" arguments="{sortBy: 'Email'}" addQueryString="TRUE"><f:translate id="module.subscriberEmail"/></f:link.action>
									</f:else>
								</f:if>
							</th>
							<th width="125"><f:translate id="module.subscriberSubscriptions"/></th>
							<th><f:translate id="module.subscriber.metaInformation"/></th>
							<th class="neos-action" width="95"></th>
						</tr>
						</thead>
						<tbody>
						<f:for each="{paginatedSubscribers}" as="subscriber" iteration="subscriberIterator">
							<tr>
								<td>{subscriber.name}</td>
								<td>{subscriber.email}</td>
								<td>
									<f:for each="{subscriber.subscribedSubscriptions}" as="subscriptionItem">
										<span class="neos-label">{subscriptionItem.name}</span>
									</f:for>
								</td>
								<td>
									<dl class="dl-horizontal">
										<f:for each="{subscriber.metadata}" as="data" key="title">
											<f:if condition="{data}">
												<dt>{title}:</dt>
												<dd><ps:format.handleVariable>{data}</ps:format.handleVariable></dd>
											</f:if>
										</f:for>
									</dl>
								</td>
								<td class="neos-action">
									<div class="neos-dropdown">
										<a class="dropdown-toggle neos-button neos-button-mini" href="#" data-neos-toggle="dropdown">
											<i class="icon-ellipsis-horizontal"></i>
										</a>
										<div class="neos-dropdown-menu-list neos-pull-right" role="menu">
											<ul>
												<li>
													<f:link.action action="edit" arguments="{subscriber: subscriber}" title="Click to edit">
														<i class="icon-pencil icon-white"></i> Edit
													</f:link.action>
												</li>
												<li>
													<f:link.action action="delete" arguments="{subscriber: subscriber}" title="Click to delete">
														<i class="icon-trash icon-white"></i> Delete
													</f:link.action>
												</li>
											</ul>
										</div>
									</div>
								</td>
							</tr>
						</f:for>
						</tbody>
					</table>
				</f:widget.paginate>
			</div>
		</div>
	</fieldset>
</f:section>

<f:section name="Scripts"></f:section>